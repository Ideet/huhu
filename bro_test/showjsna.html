<!DOCTYPE html>
<html>
<head>
    <title>JavaScriptå¯¹è±¡å±‚çº§æ¢æµ‹å™¨ - ä¿®å¤ç‰ˆ</title>
    <style>
        #object-explorer {
            position: fixed;
            top: 10px;
            left: 10px;
            width: calc(100% - 40px);
            height: calc(100vh - 40px);
            overflow: auto;
            background: #1e1e1e;
            border: 1px solid #333;
            padding: 20px;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 14px;
            line-height: 1.6;
            z-index: 9999;
            color: #d4d4d4;
            border-radius: 8px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid #007acc;
        }
        
        .title {
            font-size: 18px;
            font-weight: bold;
            color: #4ec9b0;
        }
        
        .stats {
            font-size: 14px;
            color: #9cdcfe;
        }
        
        .controls {
            margin-bottom: 15px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .control-btn {
            background: #0e639c;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }
        
        .control-btn:hover {
            background: #1177bb;
        }
        
        .search-box {
            flex-grow: 1;
            min-width: 200px;
            padding: 8px;
            background: #252525;
            border: 1px solid #3e3e3e;
            color: white;
            border-radius: 4px;
        }
        
        .tree {
            margin-left: 0;
            list-style: none;
            padding-left: 0;
        }
        
        .tree-item {
            margin: 3px 0;
        }
        
        .tree-node {
            padding: 5px 10px;
            cursor: pointer;
            border-radius: 4px;
            display: flex;
            align-items: center;
            transition: background 0.2s;
        }
        
        .tree-node:hover {
            background: #2d2d2d;
        }
        
        .tree-node.expanded {
            background: #2a2d2e;
        }
        
        .toggle {
            width: 16px;
            height: 16px;
            margin-right: 5px;
            text-align: center;
            line-height: 14px;
            font-size: 12px;
            color: #569cd6;
            cursor: pointer;
            user-select: none;
        }
        
        .node-icon {
            margin-right: 8px;
            font-size: 14px;
        }
        
        .node-name {
            color: #dcdcaa;
            font-weight: bold;
            margin-right: 10px;
        }
        
        .node-type {
            color: #4ec9b0;
            font-size: 11px;
            background: #1a1a1a;
            padding: 2px 6px;
            border-radius: 3px;
            margin-right: 8px;
        }
        
        .node-value {
            color: #ce9178;
            font-size: 12px;
            max-width: 400px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .node-path {
            color: #888;
            font-size: 11px;
            margin-left: 10px;
            font-style: italic;
        }
        
        .children {
            margin-left: 25px;
            border-left: 1px dashed #3e3e3e;
            padding-left: 15px;
            display: none;
        }
        
        .expanded > .children {
            display: block;
        }
        
        .icon-function { color: #4ec9b0; }
        .icon-object { color: #569cd6; }
        .icon-string { color: #ce9178; }
        .icon-number { color: #b5cea8; }
        .icon-boolean { color: #d7ba7d; }
        .icon-undefined { color: #888; }
        .icon-symbol { color: #c586c0; }
        
        .tooltip {
            position: absolute;
            background: #2d2d30;
            border: 1px solid #3e3e3e;
            padding: 8px 12px;
            border-radius: 4px;
            font-size: 12px;
            max-width: 400px;
            word-wrap: break-word;
            z-index: 10000;
            display: none;
        }
        
        .close-btn, .copy-btn {
            background: #2d2d30;
            color: #cccccc;
            border: 1px solid #3e3e3e;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 5px;
        }
        
        .close-btn:hover, .copy-btn:hover {
            background: #3e3e3e;
        }
        
        .method-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 5px;
            margin-top: 10px;
        }
        
        .method-item {
            padding: 5px;
            background: #252525;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
        }
        
        .method-item:hover {
            background: #2d2d2d;
        }
    </style>
</head>
<body style="background: #0e0e0e; margin: 0; padding: 0;">
    <div id="object-explorer">
        <div class="header">
            <div class="title">ğŸŒ JavaScriptå¯¹è±¡å±‚çº§æ¢æµ‹å™¨ - ä¿®å¤ç‰ˆ</div>
            <div class="stats">
                <span id="total-count">åŠ è½½ä¸­...</span>
                <span id="method-count" style="margin-left: 10px; color: #4ec9b0;"></span>
            </div>
            <button class="close-btn" onclick="toggleExplorer()">éšè—é¢æ¿</button>
            <button class="copy-btn" onclick="testWindowOpen()">æµ‹è¯•open</button>
        </div>
        
        <div class="controls">
            <input type="text" id="searchInput" class="search-box" placeholder="æœç´¢openã€alertã€closeç­‰..." 
                   onkeyup="searchTree()">
            <button class="control-btn" onclick="expandWindow()">å±•å¼€window</button>
            <button class="control-btn" onclick="showMethods()">æ˜¾ç¤ºæ–¹æ³•</button>
            <button class="control-btn" onclick="showProperties()">æ˜¾ç¤ºå±æ€§</button>
            <button class="control-btn" onclick="refresh()">åˆ·æ–°</button>
        </div>
        
        <div id="tree-container">
            <!-- æ ‘å½¢ç»“æ„å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
        </div>
        
        <div id="method-preview" style="margin-top: 20px; display: none;">
            <h3 style="color: #4ec9b0; margin-bottom: 10px;">å¸¸ç”¨windowæ–¹æ³•é¢„è§ˆ:</h3>
            <div class="method-list" id="common-methods"></div>
        </div>
        
        <div id="tooltip" class="tooltip"></div>
    </div>

<script>
// ========================= é…ç½®é€‰é¡¹ =========================
const CONFIG = {
    maxDepth: 3,
    maxChildren: 200,
    showPrototypeChain: true,
    showPrivateProperties: false,
    autoExpandWindow: true,
    valuePreviewLength: 50
};

// ========================= ä¿®å¤çš„windowå±æ€§æ”¶é›†å‡½æ•° =========================
function getWindowPropertiesEnhanced() {
    const properties = [];
    const seen = new Set();
    
    console.log("å¼€å§‹æ”¶é›†windowå±æ€§...");
    
    // 1. ä½¿ç”¨ Object.getOwnPropertyNames è·å–æ‰€æœ‰è‡ªæœ‰å±æ€§
    try {
        const ownProps = Object.getOwnPropertyNames(window);
        console.log(`Object.getOwnPropertyNames æ‰¾åˆ° ${ownProps.length} ä¸ªå±æ€§`);
        
        for (const prop of ownProps) {
            if (seen.has(prop)) continue;
            if (!CONFIG.showPrivateProperties && prop.startsWith('_')) continue;
            
            try {
                const value = window[prop];
                const type = getType(value);
                const descriptor = Object.getOwnPropertyDescriptor(window, prop);
                
                properties.push({
                    name: prop,
                    value: value,
                    type: type,
                    enumerable: descriptor ? descriptor.enumerable : false,
                    source: 'ownProperty',
                    descriptor: descriptor,
                    isMethod: type === 'function'
                });
                
                seen.add(prop);
            } catch (error) {
                // æ— æ³•è®¿é—®çš„å±æ€§
            }
        }
    } catch (error) {
        console.error("è·å–è‡ªæœ‰å±æ€§æ—¶å‡ºé”™:", error);
    }
    
    // 2. æ‰‹åŠ¨æ·»åŠ å·²çŸ¥ä½†å¯èƒ½è¢«æ¼æ‰çš„é‡è¦æ–¹æ³•
    const importantMethods = [
        'open', 'close', 'alert', 'confirm', 'prompt', 'print',
        'setTimeout', 'clearTimeout', 'setInterval', 'clearInterval',
        'requestAnimationFrame', 'cancelAnimationFrame',
        'getComputedStyle', 'matchMedia',
        'scroll', 'scrollTo', 'scrollBy',
        'fetch', 'btoa', 'atob',
        'postMessage', 'focus', 'blur',
        'moveTo', 'moveBy', 'resizeTo', 'resizeBy',
        'getSelection', 'find',
        'showModalDialog', 'showModelessDialog',
        'createImageBitmap', 'queueMicrotask',
        'structuredClone', 'reportError'
    ];
    
    for (const method of importantMethods) {
        if (!seen.has(method) && method in window) {
            try {
                const value = window[method];
                if (typeof value === 'function') {
                    properties.push({
                        name: method,
                        value: value,
                        type: 'function',
                        enumerable: false,
                        source: 'knownMethod',
                        isMethod: true,
                        important: true
                    });
                    seen.add(method);
                }
            } catch (error) {
                // å¿½ç•¥
            }
        }
    }
    
    // 3. æ·»åŠ æ¥è‡ªåŸå‹é“¾çš„é‡è¦æ–¹æ³•
    const protoMethods = [
        'toString', 'valueOf', 'hasOwnProperty', 'isPrototypeOf',
        'propertyIsEnumerable', 'toLocaleString'
    ];
    
    for (const method of protoMethods) {
        if (!seen.has(method) && method in window) {
            try {
                properties.push({
                    name: method,
                    value: window[method],
                    type: 'function',
                    enumerable: false,
                    source: 'prototype',
                    isMethod: true,
                    inherited: true
                });
                seen.add(method);
            } catch (error) {
                // å¿½ç•¥
            }
        }
    }
    
    // 4. æŒ‰ç±»å‹å’Œåç§°æ’åº
    properties.sort((a, b) => {
        // å…ˆæŒ‰æ˜¯å¦æ˜¯æ–¹æ³•æ’åºï¼ˆæ–¹æ³•åœ¨å‰ï¼‰
        if (a.isMethod && !b.isMethod) return -1;
        if (!a.isMethod && b.isMethod) return 1;
        // å†æŒ‰åç§°æ’åº
        return a.name.localeCompare(b.name);
    });
    
    console.log(`æ€»å…±æ”¶é›†åˆ° ${properties.length} ä¸ªwindowå±æ€§ï¼Œå…¶ä¸­ ${properties.filter(p => p.isMethod).length} ä¸ªæ–¹æ³•`);
    
    return properties;
}

// ========================= å·¥å…·å‡½æ•° =========================
function getType(obj) {
    if (obj === null) return 'null';
    if (obj === undefined) return 'undefined';
    
    const type = typeof obj;
    if (type !== 'object') return type;
    
    if (Array.isArray(obj)) return 'array';
    if (obj instanceof Date) return 'date';
    if (obj instanceof RegExp) return 'regexp';
    if (obj instanceof Promise) return 'promise';
    if (obj instanceof Function) return 'function';
    
    const constructorName = obj.constructor?.name;
    if (constructorName && constructorName !== 'Object') {
        return constructorName.toLowerCase();
    }
    
    return 'object';
}

function getIcon(type) {
    const icons = {
        'function': 'Æ’',
        'object': '{}',
        'array': '[]',
        'string': '"',
        'number': '#',
        'boolean': 'âœ“',
        'undefined': '?',
        'null': 'âˆ…',
        'symbol': 'âš›',
        'date': 'ğŸ“…',
        'regexp': '/',
        'promise': 'â³'
    };
    return icons[type] || 'â€¢';
}

function getTypeColor(type) {
    const colors = {
        'function': '#4ec9b0',
        'object': '#569cd6',
        'array': '#d7ba7d',
        'string': '#ce9178',
        'number': '#b5cea8',
        'boolean': '#d7ba7d',
        'undefined': '#888',
        'null': '#888',
        'symbol': '#c586c0',
        'date': '#9cdcfe',
        'regexp': '#d16969',
        'promise': '#dcdcaa'
    };
    return colors[type] || '#cccccc';
}

function formatValue(value, type) {
    if (value === null) return 'null';
    if (value === undefined) return 'undefined';
    
    try {
        if (type === 'function') {
            const funcStr = value.toString();
            const match = funcStr.match(/^(?:async\s+)?(?:function\s*\*?\s*)?(\w*)/);
            const name = match && match[1] ? match[1] : 'anonymous';
            return `${name}()`;
        }
        
        if (type === 'string') {
            const str = value.length > CONFIG.valuePreviewLength 
                ? value.substring(0, CONFIG.valuePreviewLength) + '...' 
                : value;
            return `"${str}"`;
        }
        
        if (type === 'number' || type === 'boolean') {
            return String(value);
        }
        
        if (type === 'array') {
            return `Array[${value.length}]`;
        }
        
        if (type === 'date') {
            return value.toISOString();
        }
        
        if (type === 'regexp') {
            return value.toString();
        }
        
        if (type === 'object') {
            try {
                const keys = Object.keys(value);
                return `Object {${keys.length}}`;
            } catch {
                return 'Object {...}';
            }
        }
        
        return String(value).substring(0, CONFIG.valuePreviewLength);
    } catch (error) {
        return '[ä¸å¯è®¿é—®]';
    }
}

// ========================= æ ‘å½¢ç»“æ„æ¸²æŸ“ =========================
function createTreeNode(node, level = 0) {
    const hasChildren = node.value && typeof node.value === 'object' && 
                       node.type !== 'null' && node.type !== 'undefined' &&
                       !(node.type === 'function' && !node.value.prototype);
    
    const isExpanded = level === 0 && CONFIG.autoExpandWindow;
    const icon = getIcon(node.type);
    const typeColor = getTypeColor(node.type);
    const displayValue = formatValue(node.value, node.type);
    
    const nodeId = `node-${Math.random().toString(36).substr(2, 9)}`;
    
    return `
        <div class="tree-item" data-node-id="${nodeId}" data-path="${node.path}" data-type="${node.type}">
            <div class="tree-node ${isExpanded ? 'expanded' : ''}" 
                 onclick="toggleNode(this, '${node.path}', '${node.type}')"
                 onmouseenter="showTooltip(event, '${node.path}')"
                 onmouseleave="hideTooltip()">
                ${hasChildren ? `
                    <span class="toggle">${isExpanded ? 'â–¼' : 'â–¶'}</span>
                ` : `<span class="toggle" style="visibility: hidden;">â€¢</span>`}
                <span class="node-icon" style="color: ${typeColor}">${icon}</span>
                <span class="node-name">${node.name}</span>
                ${node.inherited ? '<span style="color:#888; font-size:10px; margin:0 5px;">(ç»§æ‰¿)</span>' : ''}
                ${node.important ? '<span style="color:#ff6b6b; font-size:10px; margin:0 5px;">(é‡è¦)</span>' : ''}
                <span class="node-type">${node.type}</span>
                <span class="node-value">${displayValue}</span>
                <span class="node-path">${node.path}</span>
            </div>
            ${hasChildren ? `
                <div class="children" style="${isExpanded ? 'display:block;' : 'display:none;'}">
                    <!-- å­èŠ‚ç‚¹å°†åœ¨è¿™é‡ŒåŠ¨æ€åŠ è½½ -->
                </div>
            ` : ''}
        </div>
    `;
}

function renderTree() {
    const container = document.getElementById('tree-container');
    container.innerHTML = '';
    
    console.log("å¼€å§‹æ¸²æŸ“æ ‘å½¢ç»“æ„...");
    
    // åˆ›å»ºwindowèŠ‚ç‚¹
    const windowNode = {
        name: 'window',
        value: window,
        type: 'object',
        enumerable: true,
        path: 'window',
        isOwnProperty: true,
        description: 'å…¨å±€çª—å£å¯¹è±¡'
    };
    
    const tree = document.createElement('div');
    tree.className = 'tree';
    tree.innerHTML = createTreeNode(windowNode, 0);
    
    container.appendChild(tree);
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStats();
    
    // æ˜¾ç¤ºå¸¸ç”¨æ–¹æ³•é¢„è§ˆ
    showCommonMethods();
}

function toggleNode(element, path, type) {
    const treeNode = element.closest('.tree-item');
    const childrenDiv = treeNode.querySelector('.children');
    
    if (!childrenDiv) return;
    
    const isExpanded = element.classList.contains('expanded');
    
    if (isExpanded) {
        // æŠ˜å 
        element.classList.remove('expanded');
        childrenDiv.style.display = 'none';
        element.querySelector('.toggle').textContent = 'â–¶';
    } else {
        // å±•å¼€
        element.classList.add('expanded');
        childrenDiv.style.display = 'block';
        element.querySelector('.toggle').textContent = 'â–¼';
        
        // å¦‚æœå­èŠ‚ç‚¹è¿˜æœªåŠ è½½ï¼Œç°åœ¨åŠ è½½
        if (childrenDiv.children.length === 0) {
            if (path === 'window') {
                loadWindowChildren(childrenDiv);
            } else {
                loadChildren(path, childrenDiv);
            }
        }
    }
}

function loadWindowChildren(container) {
    console.log("åŠ è½½windowå­èŠ‚ç‚¹...");
    
    const properties = getWindowPropertiesEnhanced();
    
    if (properties.length === 0) {
        container.innerHTML = '<div style="color:#888; padding:5px;">[æ— æ³•è®¿é—®å±æ€§]</div>';
        return;
    }
    
    const children = properties.map(prop => ({
        name: prop.name,
        value: prop.value,
        type: prop.type,
        enumerable: prop.enumerable,
        path: `window.${prop.name}`,
        isOwnProperty: prop.source === 'ownProperty',
        inherited: prop.inherited,
        important: prop.important,
        isMethod: prop.isMethod
    }));
    
    container.innerHTML = children.map(child => createTreeNode(child, 1)).join('');
    
    // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
    updateStats();
    
    console.log(`æˆåŠŸåŠ è½½ ${children.length} ä¸ªwindowå­èŠ‚ç‚¹`);
    
    // ç‰¹åˆ«æ ‡è®°openæ–¹æ³•
    const openNode = container.querySelector('[data-path="window.open"]');
    if (openNode) {
        const nodeElement = openNode.querySelector('.tree-node');
        nodeElement.style.border = '1px solid #4ec9b0';
        nodeElement.style.background = '#2a2d2e';
    }
}

function loadChildren(path, container) {
    const parts = path.split('.');
    let obj = window;
    
    for (const part of parts) {
        if (obj && typeof obj === 'object' && part in obj) {
            obj = obj[part];
        } else {
            container.innerHTML = '<div style="color:#888; padding:5px;">[æ— æ³•è®¿é—®]</div>';
            return;
        }
    }
    
    // è·å–å­å±æ€§
    const children = [];
    const seen = new Set();
    
    try {
        const ownProps = Object.getOwnPropertyNames(obj);
        for (const prop of ownProps) {
            if (!CONFIG.showPrivateProperties && prop.startsWith('_')) continue;
            if (seen.has(prop)) continue;
            
            try {
                const value = obj[prop];
                children.push({
                    name: prop,
                    value: value,
                    type: getType(value),
                    enumerable: true,
                    path: `${path}.${prop}`,
                    isOwnProperty: true
                });
                seen.add(prop);
            } catch (error) {
                // å¿½ç•¥
            }
        }
    } catch (error) {
        // å¿½ç•¥é”™è¯¯
    }
    
    if (children.length === 0) {
        container.innerHTML = '<div style="color:#888; padding:5px;">[æ— å±æ€§]</div>';
        return;
    }
    
    container.innerHTML = children.map(child => createTreeNode(child, path.split('.').length)).join('');
}

// ========================= äº¤äº’åŠŸèƒ½ =========================
function searchTree() {
    const searchTerm = document.getElementById('searchInput').value.toLowerCase().trim();
    const allNodes = document.querySelectorAll('.tree-node');
    
    if (!searchTerm) {
        allNodes.forEach(node => {
            node.style.background = '';
            const item = node.closest('.tree-item');
            if (item) item.style.display = '';
        });
        return;
    }
    
    allNodes.forEach(node => {
        const item = node.closest('.tree-item');
        const name = node.querySelector('.node-name')?.textContent.toLowerCase() || '';
        const path = node.querySelector('.node-path')?.textContent.toLowerCase() || '';
        
        const matches = name.includes(searchTerm) || path.includes(searchTerm);
        
        if (item) {
            item.style.display = matches ? '' : 'none';
            if (matches) {
                node.style.background = '#3a3d41';
                
                // ç¡®ä¿çˆ¶èŠ‚ç‚¹éƒ½å±•å¼€
                let parent = item.parentElement;
                while (parent && !parent.classList.contains('tree')) {
                    if (parent.classList.contains('children')) {
                        const parentNode = parent.previousElementSibling;
                        if (parentNode && parentNode.classList.contains('tree-node')) {
                            if (!parentNode.classList.contains('expanded')) {
                                parentNode.click();
                            }
                        }
                    }
                    parent = parent.parentElement;
                }
            } else {
                node.style.background = '';
            }
        }
    });
}

function expandWindow() {
    const searchInput = document.getElementById('searchInput');
    searchInput.value = '';
    searchTree();
    
    // å±•å¼€windowèŠ‚ç‚¹
    const windowNode = document.querySelector('[data-path="window"] .tree-node');
    if (windowNode && !windowNode.classList.contains('expanded')) {
        windowNode.click();
        
        // åŠ è½½å®Œæˆåæ»šåŠ¨åˆ°openæ–¹æ³•
        setTimeout(() => {
            const openNode = document.querySelector('[data-path="window.open"]');
            if (openNode) {
                openNode.scrollIntoView({ behavior: 'smooth', block: 'center' });
                const nodeElement = openNode.querySelector('.tree-node');
                nodeElement.style.animation = 'pulse 1.5s';
            }
        }, 500);
    }
}

function showMethods() {
    const searchInput = document.getElementById('searchInput');
    searchInput.value = 'function';
    searchTree();
}

function showProperties() {
    const searchInput = document.getElementById('searchInput');
    searchInput.value = 'object';
    searchTree();
}

function refresh() {
    renderTree();
}

function toggleExplorer() {
    const explorer = document.getElementById('object-explorer');
    explorer.style.display = explorer.style.display === 'none' ? 'block' : 'none';
}

function updateStats() {
    const allNodes = document.querySelectorAll('.tree-item');
    const methodNodes = document.querySelectorAll('.tree-item[data-type="function"]');
    
    document.getElementById('total-count').textContent = 
        `æ€»èŠ‚ç‚¹: ${allNodes.length}`;
    document.getElementById('method-count').textContent = 
        `æ–¹æ³•: ${methodNodes.length}`;
}

function showCommonMethods() {
    const container = document.getElementById('method-preview');
    const list = document.getElementById('common-methods');
    
    const commonMethods = [
        { name: 'open()', desc: 'æ‰“å¼€æ–°çª—å£', test: () => window.open('about:blank', '_blank', 'width=400,height=300') },
        { name: 'close()', desc: 'å…³é—­å½“å‰çª—å£', test: () => { if(confirm('ç¡®å®šè¦å…³é—­çª—å£å—ï¼Ÿ')) window.close(); } },
        { name: 'alert()', desc: 'æ˜¾ç¤ºè­¦å‘Šæ¡†', test: () => window.alert('è¿™æ˜¯alertæ–¹æ³•æµ‹è¯•') },
        { name: 'confirm()', desc: 'æ˜¾ç¤ºç¡®è®¤æ¡†', test: () => window.confirm('è¿™æ˜¯confirmæ–¹æ³•æµ‹è¯•') },
        { name: 'prompt()', desc: 'æ˜¾ç¤ºè¾“å…¥æ¡†', test: () => window.prompt('è¯·è¾“å…¥å†…å®¹:', 'æµ‹è¯•') },
        { name: 'setTimeout()', desc: 'è®¾ç½®å»¶æ—¶æ‰§è¡Œ', test: () => { const id = setTimeout(() => alert('setTimeoutæµ‹è¯•'), 1000); setTimeout(() => clearTimeout(id), 500); } },
        { name: 'setInterval()', desc: 'è®¾ç½®é—´éš”æ‰§è¡Œ', test: () => { const id = setInterval(() => console.log('interval'), 1000); setTimeout(() => clearInterval(id), 3000); } }
    ];
    
    list.innerHTML = commonMethods.map(method => `
        <div class="method-item" onclick="${method.test.toString().replace(/\n/g, ' ')}">
            <strong style="color: #4ec9b0;">${method.name}</strong><br>
            <span style="color: #888; font-size: 11px;">${method.desc}</span>
        </div>
    `).join('');
    
    container.style.display = 'block';
}

function testWindowOpen() {
    // åœ¨æ–°æ ‡ç­¾é¡µä¸­æ‰“å¼€ä¸€ä¸ªç®€å•çš„æµ‹è¯•é¡µé¢
    const newWindow = window.open('', '_blank', 'width=500,height=300,menubar=no,toolbar=no');
    if (newWindow) {
        newWindow.document.write(`
            <!DOCTYPE html>
            <html>
            <head>
                <title>window.openæµ‹è¯•é¡µé¢</title>
                <style>
                    body { font-family: Arial; padding: 20px; }
                    h2 { color: #4ec9b0; }
                </style>
            </head>
            <body>
                <h2>window.open() æµ‹è¯•æˆåŠŸ!</h2>
                <p>è¿™æ˜¯ä¸€ä¸ªé€šè¿‡window.open()æ–¹æ³•æ‰“å¼€çš„æ–°çª—å£ã€‚</p>
                <p>å½“å‰URL: ${window.location.href}</p>
                <button onclick="window.close()">å…³é—­æ­¤çª—å£</button>
            </body>
            </html>
        `);
    } else {
        alert('å¯èƒ½è¢«æµè§ˆå™¨é˜»æ­¢äº†ï¼Œè¯·å…è®¸å¼¹å‡ºçª—å£');
    }
}

function showTooltip(event, path) {
    const tooltip = document.getElementById('tooltip');
    
    try {
        const parts = path.split('.');
        let obj = window;
        for (const part of parts) {
            if (obj && typeof obj === 'object' && part in obj) {
                obj = obj[part];
            } else {
                break;
            }
        }
        
        const type = getType(obj);
        const value = formatValue(obj, type);
        const descriptor = Object.getOwnPropertyDescriptor(window, parts[parts.length-1]);
        
        tooltip.innerHTML = `
            <strong style="color: #dcdcaa;">${path}</strong><br>
            <span style="color: ${getTypeColor(type)}">ç±»å‹: ${type}</span><br>
            å€¼: ${value}<br>
            ${descriptor ? `å¯æšä¸¾: ${descriptor.enumerable ? 'æ˜¯' : 'å¦'}<br>` : ''}
            æ„é€ å‡½æ•°: ${obj?.constructor?.name || 'N/A'}
        `;
        
        tooltip.style.left = (event.clientX + 15) + 'px';
        tooltip.style.top = (event.clientY + 15) + 'px';
        tooltip.style.display = 'block';
    } catch (error) {
        tooltip.innerHTML = `<strong>${path}</strong><br>æ— æ³•è®¿é—®`;
        tooltip.style.left = (event.clientX + 15) + 'px';
        tooltip.style.top = (event.clientY + 15) + 'px';
        tooltip.style.display = 'block';
    }
}

function hideTooltip() {
    const tooltip = document.getElementById('tooltip');
    tooltip.style.display = 'none';
}

// ========================= åˆå§‹åŒ– =========================
window.addEventListener('load', function() {
    console.log('åˆå§‹åŒ–JavaScriptå¯¹è±¡å±‚çº§æ¢æµ‹å™¨...');
    console.log('window.openæ–¹æ³•æ˜¯å¦å­˜åœ¨:', 'open' in window);
    console.log('window.openæ–¹æ³•çš„ç±»å‹:', typeof window.open);
    
    renderTree();
    
    // è‡ªåŠ¨å±•å¼€windowå¹¶æ˜¾ç¤ºopenæ–¹æ³•
    if (CONFIG.autoExpandWindow) {
        setTimeout(() => {
            expandWindow();
        }, 300);
    }
    
    // æ·»åŠ é”®ç›˜å¿«æ·é”®
    document.addEventListener('keydown', function(e) {
        if (e.ctrlKey && e.key === 'f') {
            e.preventDefault();
            document.getElementById('searchInput').focus();
        }
        if (e.key === 'Escape') {
            document.getElementById('searchInput').value = '';
            searchTree();
        }
    });
});

// æ·»åŠ CSSåŠ¨ç”»
const style = document.createElement('style');
style.textContent = `
    @keyframes pulse {
        0% { background: #2a2d2e; }
        50% { background: #0e639c; }
        100% { background: #2a2d2e; }
    }
`;
document.head.appendChild(style);
</script>
</body>
</html>
